---
marp: true
theme: gaia
class: invert
size: 16:9
style: |
  img[alt='center'] {
      display: block;
      margin: 0 auto;
  }
  strong,b {
    color: red;
  }
  h2 strong,b {
    color: red;
  }
---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 関数型ドメインモデリング

## 〜ドメイン駆動設計とF#でソフトウェアの複雑さに立ち向かおう〜

---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 第1部: ドメインの理解


---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 第1章: ドメイン駆動設計の紹介

---

## ソフトウェア開発者の仕事

- ❌ コードを書く
- ⭕️ ソフトウェアを使って問題を解決する

---

## 問題を解決するために必要なこと

- 問題を正しく「理解」する

---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

## 問題を理解するために必要なことは？

---

## ドメインエキスパート（問題を最もよく理解している人）と密接にコミュニケーションを取る

- ただ、これだけだとコードに対する「翻訳」作業が発生する
- 認識のズレにつながる...🤔

---

##  ドメインエキスパート・開発者・コードが同じメンタルモデルを共有する

- メンタルモデルをコードに直接反映する
- ドメインエキスパートからコードへの翻訳作業が発生しない
- 認識のズレも生まれにくい

=> ドメイン駆動設計が目指す状態！

---

## 共通のモデルを作成するために

- データ構造ではなく、ビジネスイベント（`ドメインイベント`）やワークフローに焦点を当てる
- ドメインをより小さなサブドメインに分割する
- 各サブドメインのモデルを解決空間に作成する
- プロジェクトに関わる全ての人が共有し、コードのあらゆる場所で使用される共通言語（`ユビキタス言語`）を開発する

---

## データ構造ではなく、ビジネスイベントやワークフローに焦点を当てる

- ドメインイベントはモデル化したいビジネスプロセスの「出発点」なので
- ドメインの探索には`イベントストーミング`が有効

---

## ドメインをより小さなサブドメインに分割する

- 問題を小さくすることで解決しやすくする
- 小さくすることで役割が限定的になるので、ドメインとしても表現しやすい

---

## 各サブドメインのモデルを解決空間に作成する

- 「問題空間（現実世界）」と「解決空間（ドメインモデル）」を区別
- ドメインの必要な部分だけを取り出して解決空間にマッピング
- 解決空間では、問題空間のドメインとサブドメインがDDD用語で`境界づけられたコンテキスト`と呼ばれるものにマッピングされる
- コンテキスト間の相互作用・全体像を把握するため`コンテキストマップ`を作成する

<!-- 「境界」を明確にしたコンテキストを定義することで、疎結合なシステムを構築できる -->

---

## プロジェクトに関わる全ての人が共有し、コードのあらゆる場所で使用される共通言語（ユビキタス言語）を開発する

- チームの全員が共有する概念と語彙のセット
- ビジネスドメインの共有メンタルモデルを定義する言語
- 全員がドメインに対して共通の理解を持つために必要

---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 第2章: ドメインの理解

---

## ドメインエキスパートへのインタビュー

- 自分のメンタルモデルをドメインに押し付けない
- 勝手な先入観を持たないことが重要
- 全てを受け入れる姿勢を持ち、自分の技術的な考えをドメインに押し付けない

---

## データベース駆動設計はしない

- `永続性非依存`
- データーベースの視点で設計をしていると、データベースモデルに合わせて設計を歪めてしまうことがある
- データベース駆動設計と同様、クラス駆動設計はしないようにする

---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 第3章: 関数型アーキテクチャ 

---

## 境界付けられたコンテキストのコミュニケーション 

- `イベント`を使って表現できる
- 完全に疎結合な設計
  - 上位のコンポーネントと下位のコンポーネントはイベントを通じてのみコミュニケーションを取る

---

## 境界付けられたコンテキスト間のデータ転送

- コンテキスト間のコミュニケーションに使用されるイベントは、単なる信号ではなく、下流のコンポーネントが処理するために必要な全てのデータを含む
- 上流のコンテキストの境界で、ドメインオブジェクトは`DTO`に変換される

---

## 信頼の境界線と検証

- 境界づけられたコンテキストの境界線は、`信頼の境界線`として機能する
- 境界付けられたコンテキストの外側にあるものは信頼されておらず、無効である可能性がある
- そのため、ワークフローの最初と最後に`ゲート`を追加し、信頼されたドメインと信頼されていない外の世界との間の仲介者として機能するようにする

---

<!--
_class:
  - lead
  - invert
_footer: ""
-->

# 第2部: ドメインのモデリング 

//

---

<!--
backgroundColor: black
footer: ""
-->
