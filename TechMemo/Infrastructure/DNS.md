# CHAPTER1: DNSが作られた背景

- IPは人間が覚えにくい..
- ホストのIPが変更された場合に困る..
- これらを解消するために、IPに人間が覚えやすい名前を付けて、接続の度に名前と対応している（現在使っている）IPを調べることにした
- そこで最初に採用されたのが、`SRI-NIC`という組織がHOSTSファイルを一元管理する仕組み
- しかし、ホストの数が増えるに従って、一元管理には限界が出てきた..
- そこで採用されたのが`階層化`と`委任`という`分散管理`の仕組み
    - 階層化と委任については`会社`をイメージすると分かりやすい
    - 責任範囲を分離して管理しやすくする
- `ツリー構造(木構造)`を採用することで名前を一意にすることができる

## ドメイン名について

- ドメイン名は`「.（ドット）」で繋げた形`で構成される
- それぞれの文字列を`ラベル`と言う
- ドメイン名の最後にもドットが付いているが、通常は省略される
- ドメイン名の最後に付けられた（省略された）ドットは階層構造の頂点となる`ルート`を表しており、ルートを起点として右側から順に
    - TLD(Top Level Domain)
        - e.g. .jp, .com
    - 2LD
    - 3LD

### サブドメイン

- ある名前空間の範囲が別の名前空間の範囲に含まれている場合、名前空間1は名前空間2の`サブドメイン`と呼ばれる
    - e.g. ルートの名前空間を分割してできたドメインは、全てルートのサブドメインとなる

## DNS

P20あたり

- DNS(Domain Name System)
- `階層化と委任による分散管理の仕組みを採用`している
- `名前解決`（ドメイン名に対応するIPアドレスを探し出す）を行う
- DNSの基本
    - `それぞれの階層の管理者から必要な情報を入手してドメイン名の階層構造を辿り、最終的な答えであるIPアドレスを得る`
        - 参考(分かりやすい): https://jprs.jp/related-info/guide/topics-column/no10.html
    - DNSでは委任によって管理された範囲を`ゾーン`と呼ぶ
    - また、委任元と委任先は`親`と`子`の関係になる
    - それぞれのゾーンの管理者は`⭐️ネームサーバー`というサーバーで情報を管理する
    - ネームサーバーでは、以下の`2種類の情報が管理`される
        - `そのゾーンに存在するホストのドメイン名とIPアドレス`
        - `委任の情報`
            - 委任先（子）のネームサーバーの情報で、委任元（親）のネームサーバーが管理する
            - `委任先はこのネームサーバーです`という情報
            - 委任先を案内する
    - このように`委任先をルートから順に辿って、最終的にexample.jpのIPアドレスを管理するネームサーバーにたどり着く`という仕組みが、DNSにおける名前解決の基本

### DNSとレジストリの関係

- ドメイン名とDNSによる階層構造を導入した場合、それぞれの階層を管理する管理者（`レジストリ`）が必要になる
- それぞれのレジストリには以下の2つの責任が発生する
    1. 自分が任された（委任された）ゾーンを管理する
    2. ゾーンを委任した場合、そのゾーンを委任した人（委任先）が誰かを管理する

# CHAPTER2: ドメイン名の登録管理の仕組みと管理体制

- インターネット上の番号や名前の割り当て・登録を担当する組織のことを`レジストリ`と言う

## レジストリの役割

- ドメイン名を使えるようにするには、レジストリに対して「このドメイン名を使いたい」という登録申請をする
- 申請を受けたレジストリは、その内容が登録要件を満たしているかを審査・確認し、レジストリが管理するデータベースに登録する
    - 申請者がそのドメイン名を使う権利を得ることになる
- 登録したドメイン名には有効期限が設定され、その`ライフサイクル`に則って運用する必要がある
- レジストリの主な役割は以下の6つ
    1. レジストリデータベースの運用管理
    2. ポリシーに基づいた登録規則の策定
    3. 登録申請の受け付け
    4. Whoisサービス（自身の管理するドメイン名の情報）の提供
    5. ネームサーバーの運用
    6. 情報発信・教育啓蒙活動

## ドメイン名のライフサイクル

- ドメイン名の期限が切れるタイミングを見計らってドメイン名を取得する行為を`ドロップキャッチ`と言う

## Whoisとその役割

P30

- `Whois`は、`ドメイン名やIPアドレスのレジストリが管理する登録・割り当て情報をインターネット上に公開し、利用者が参照できるようにする`サービス

## レジストリとTLDの関係

- `各TLDにはレジストリが存在`する
- それぞれのレジストリがTLDを管理し、管理のポリシーや登録規則を定めている
- TLDは、大きく以下の2種類に分けられる
    - 国や地域ごとに割り当てられる
        - `ccTLD(Country Code Top Level Domain)`
        - e.g. .jp
    - 国や地域によらない
        - `gTLD(General Top Level Domain)`
        - e.g. .com, .net

## ドメイン名と商標権

- ドメイン名は利用者にとってより身近な組織名、サービス名、商品名といったものを連想させる
- そのため、そうした文字列を巡るトラブルや紛争への対応が必要になる
- 対応が必要な項目として、ドメイン名を不正な目的で登録・使用する`サイバースクワッティング`がある
- こうした行為に対応するために導入されたのが`DRP(ドメイン名紛争処理方針)`というドメイン名の登録・使用に関して生じた紛争を処理するための仕組み

## レジストリ・レジストラモデルとレジストラの役割

- ドメイン名を使うためには、そのドメイン名を管理するレジストリのレジストリデータベースへの登録が必要
- 主要なTLDでは、その登録の仕組みとして`レジストリ・レジストラモデル`が採用されている
- レジストリ・レジストラモデルは、ドメイン名の登録管理を以下の二つに分離する
    - `ドメイン名登録者からの申請を取り次ぐ役割を担う`
        - `レジストラ`
    - `ドメイン名の一元管理を行う`
        - `レジストリ`
- このように分離する理由は、登録されるドメイン名を一意に保ちつつ、価格やサービス面における多様性を確保するため
    - 一つのTLDに対してレジストリは1つだが、レジストリは通常複数存在する
- `リセラ`
    - レジストラを介して登録したドメイン名を別の登録者に再販すること
        - レジストラの手前に存在

## ⭐️ドメイン名を使えるようにする

P45あたり
TODO: より深く理解する

- ドメイン名を使えるようにする=そのドメイン名のWebサイトにWebブラウザにアクセスできるようにする
- Webサイトにアクセスできるようにするためには、そのドメイン名をインターネットで使えるようにするための機構、つまり、DNSの情報を管理する`ネームサーバー`を登録する必要がある

### ⭐️登録者の作業の流れ

1. 自分のドメイン名を取り扱うネームサーバーをインターネット上で動かす

ネームサーバーは、インターネット上のどこからでもアクセス可能である必要がある。

※ネームサーバーを提供する事業者のサービスを利用することが一般的

2. 登録したドメイン名に関する情報をネームサーバーに設定する

ドメイン名とIPアドレスを設定。

3. ネームサーバーが、インターネットから聞かれたことに答えられるかを確認する

e.g. 「example.jpのIPアドレスは？」に答えられること

ネームサーバーの準備が完了したら、ドメイン名登録の際に申請した事業者（レジストラ）に、ネームサーバー情報の設定を申請する。

レジストリは、ネームサーバー情報をレジストリデータベースに登録し、レジストリの管理するネームサーバーにその情報を設定する。

これにより、`レジストリの親子関係`ができる。

ここまでの設定が完了すると、実際にWebサーバーを立ち上げて、そのドメイン名のWebサイトにWebブラウザでアクセスできるか確認できるようになる。

## ドメイン名のグローバルな管理体制

- インターネット上には数多くのTLDが存在し、TLD毎にレジストリが存在する
- ドメイン名やIPアドレスなどのインターネット識別子をグローバルに管理・調整する役割は、`ICANN(Internet Corporation for Assigned Names and Numbers, アイキャン)`という組織がになっている

# CHAPTER3: DNSの名前解決

P54

## 階層構造を辿る

- DNSはルートから階層構造を辿って最終的なIPアドレスを手にいれる
- この行為のことを`iterative resolution(繰り返しによる解決)`という

## 名前解決の動作

1. 問い合わせを受け取ったネームサーバーは、自分が知っている以下のいずれかの情報を応答する
    - 委任情報
    - ドメイン名に紐付くIPアドレスの情報
2. クライアントは、応答がネームサーバー情報であるか、求める答えであるかで行う動作を変える

## 名前解決の負荷と時間の軽減

P60

- クライアントがそれぞれのネームサーバーとやりとりをしていると手間（負荷）と時間がかかる
- そこで、名前解決を代行する仕組みが考えられた
- クライアントは代行者に対してドメイン名を渡し、実際の名前解決は代行者が行い、クライアントは最後の結果（IPアドレス）のみを受け取る

## 名前解決のために必要なこと

- `委任情報`の登録
    - 親が応答する委任情報は子が登録したネームサーバー情報

p64

## 名前解決における委任の重要性

P66

- ゾーン（委任によって管理を任された範囲）毎の分散管理を実現できる
- ゾーンをどのように扱うかを、そのゾーンの管理者が決められる
- あるゾーンにトラブルが発生しても、その影響範囲を局所化できる

# CHAPTER4: DNSの構成要素と具体的な動作

P72

- 3種類の構成要素とその役割
    - 情報が欲しい人
        - `スタブリゾルバー`
    - 情報が欲しい人からの依頼を受けて、名前解決をする人
        - `フルリゾルバー（フルサービスリゾルバー）`
    - 情報を提供する人
        - `権威サーバー`
- スタブリゾルバー -> フルリゾルバー -> 権威サーバー
    
## スタブリゾルバーの役割

- PCやスマホなどで動作
- Webブラウザやアプリなどから呼び出される
- フルリゾルバーに名前解決の依頼を出す
    - `名前解決要求`と呼ぶ

## フルリゾルバーの役割

P74

- 実際に名前解決を行う
- スタブリゾルバーからの依頼を受けて、名前解決を行い、結果を返す
- スタブリゾルバーから名前解決要求を受け付けたフルリゾルバーは、以下の2つを行う
    1. 名前解決を実行する
        - これまでにも同じ条件の名前解決を行なっていて、そのときの情報を蓄えてる場合はその情報を返す
    2. 名前解決の際に得られた情報を蓄える（`キャッシュ`する）

## 権威サーバーの役割

- `権威サーバー（ネームサーバー）`は自分が委任を受けたゾーンの情報と、自分が委任しているゾーンの委任情報を保持する
- 権威サーバーは知りたい情報の名前（`ドメイン名`）と種類（`タイプ`）に加え、ネットワークの種類（`クラス`）も指定される
- ⭐️権威サーバーはそのゾーンの設定内容（`ゾーンデータ`）を`リソースレコード`という形で保持する
- リソースレコードは`ドメイン名`・`タイプ`・`クラス`という3つの情報の組み合わせて構成される

## DNSのクラスについて

- DNSが開発された1980年代当時の状況から、DNSはIP以外の通信にも対応できるように、ネットワークの種類として`クラス`を指定できるようになっている
- その後、インターネットの広がりとともに、インターネットを表す`IN`以外のクラスは使われなくなった
- 現在はIN以外のクラスは特殊な用途でのみ使われている

## リソースレコードの構成

- リソースレコードの例
    - jprs.jp
        - ドメイン名
    - 300
        - TTL
        - キャッシュ時間
    - IN
        - クラス
    - A
        - タイプ
        - 情報の種類
        - どんな情報を知りたいかによって、ここの内容が変わる
    - 117.104.133.164
        - データ

## ⭐️リソースレコードのタイプ
    - A
        - そのドメイン名のIPv4アドレスを指定
    - AAAA（クワッドエー）
        - そのドメイン名のIpv6アドレスを指定
    - NS（エヌエス）
        - そのゾーンの権威サーバーのホスト名を指定
    - MX（エムエックス）
        - そのドメイン名宛ての電子メールの配送先と優先度を指定

## ルートサーバーのIPアドレスはどうやって知る？

- フルリゾルバーはルートサーバーの一覧を初めから知っており、その情報を使ってルートサーバーに問い合わせを行う
- 初めから知っているルートサーバーの一覧を`ヒントファイル`、最新のルートサーバーの一覧を知るための仕組みを`プライミング`と言う

## DNSの処理の効率化と可用性の向上（キャッシュについて）

P88

- `キャッシュ`と`ネガティブキャッシュ`
    - 「存在しない」という結果もキャッシュする（`ネガティブキャッシュ`）
        - DNSが開発された当初、フルリゾルバーは名前解決で得られた最終結果と委任情報をキャッシュしていた
        - しかし、DNSを運用する中で、それでは不十分だということが分かってきた
        - e.g. 

# Cloud DNSを使ってDNS登録してみた

# めも

- `階層化`と`委任`がキーワード

# 参考

- DNSがよく分かる教科書

# TODO

- 記事にまとめて複数媒体でアウトプット
    - 英語でも
- LT資料にしてYouTubeに上げる
    - 音声変換など？
- LT発表する
- 絶対やる