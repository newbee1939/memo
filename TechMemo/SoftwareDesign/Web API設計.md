## Web APIを美しく設計する重要性

Web APIを美しく設計すべき理由。

- 設計の美しいWeb APIは使いやすい
- 設計の美しいWeb APIは変更しやすい
    - `いきなりAPIの仕様が変わると使っている側が困る`
- 設計の美しいWeb APIは頑強である
- 設計の美しいWeb APIは恥ずかしくない

## Web APIを美しくするには

根幹となる原則。

- 仕様が決まっているものに関しては仕様に従う
- 仕様が存在していないものに関してはデファクトスタンダードに従う

## エンドポイントの基本的な設計

良いURIの設計とは？

`覚えやすく、どんな機能を持つURIなのかがひと目でわかる`

具体的には以下のようなURI。

- 短く入力しやすいURI
- 人間が読んで理解できるURI
    - むやみに省略形を使わない
- 大文字小文字が混在していないURI
- 改造しやすい（Hackableな）URI
    - URIを修正して別のURIにするのが容易である
    - URIを見ただけで使い方が分かるのがベスト
- サーバ側のアーキテクチャが反映されていないURI
- ルールが統一されたURI

## エンドポイント設計の注意点

- `複数形`の名詞を利用する
- 利用する単語に気をつける
- スペースやエンコードを必要とする文字を使わない
- 単語をつなげる必要がある場合はハイフンを利用する

## 検索とクエリパラメータの設計

### 取得数と取得位置のクエリパラメータ

- 以下のいずれか
    - page/per_page
    - offset/limit

offset/limitの方が自由度が高いのでユーザーにとっては使いやすい。

## レスポンスデータの設計

### データフォーマット

- JSONで返す

### データの内部構造

- まず考えるべきことは、`APIのアクセス回数がなるべく減るようにする`

### データはフラットにすべきか？

- `なるべくフラットにすべきだけど、階層化した方が絶対によい場合は階層化もあり`

### 配列とフォーマット

- オブジェクトで包んだ記述方法の方がオススメ

### 各データのフォーマット

- 多くのAPIで同じ意味に利用されている一般的な単語を用いる
- なるべく少ない単語数で表現する
- 複数の単語を連結する場合、その連結方法はAPI全体を通して統一する
- 変な省略形は極力使用しない
- 単数形/複数形に気をつける

### エラーの表現

#### ステータスコードでエラーを表現する

- `適切なステータスコードを使う`

#### エラーの詳細をクライアントに返す

エラーの内容を返す方法は大きく分けて二つある。

- HTTPのレスポンスヘッダに入れて返す方法
- レスポンスボディで返す方法

現実に公開されているAPIはほとんど`ボディにエラーメッセージを格納する方法`を取っている。

#### エラーの詳細情報には何を入れるべきか？

- エラーの詳細コード
    - API提供側で独自にエラーごとに定義したコード
- 詳細情報へのリンク
- メッセージ
    - 開発者向けと非開発者向けを返す方法もある

```json
{
    error: {
        "developerMessage": "hogehoge...",
        "userMessage": "...fugafuga",
        "code": 2013,
        "info": "http://hoge.com",
    }
}
```

#### エラーの際にHTMLが変えることを防ぐ

- エラーの場合にデフォルトでHTMLでエラーを返しているフレームワークやWebサーバーが存在する
- ちゃんとチェックして適切な情報が適切なフォーマットで返るように

#### メンテナンス時

- 503を返す

## 堅牢なWeb APIを作る

### セキュリティの問題のパターン

- サーバとクライアントの間での情報の不正入手
    - `HTTPSにする`
- サーバの脆弱性による情報の不正入手や改ざん
- ブラウザからのアクセスを想定しているAPIにおける問題

## 参考

- https://www.engilaboo.com/web-api-qa/