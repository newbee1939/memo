## 例外の種類

- 例外は大きく以下の2種類に分けられる
    - `想定外の例外`
    - `想定通常のユースケースで発生しうる例外`
- 例外処理は、この種類に応じて方針を切り分けることが重要

### 想定外の例外

- サーバー側の問題で、500系のレスポンスを返すような場合
- 代表的なものとしては、メソッドの呼び出しの前提条件を満たさない場合のエラー
    - ex. not nullと定義されている引数にnullを渡してしまった場合
    - ex. 外部リソース（DBなど）との接続エラー
- このような例外が発生した場合、ユーザーは通常ユースケースとしての回避策がないため、内部エラー時の共通のレスポンスを返すことになる
- 実装方法としては、非検査例外を投げ、プレゼンテーション層の共通クラスで一律キャッチする
- キャッチした共通クラスにおける返し方はクライアントの種類によって異なる
    - 共通エラーページのHTMLを返すか、エラー用のjsonレスポンスを返す

### 通常のユースケースで発生しうる例外

- クライアント側の問題で、400系のレスポンスを返すような場合
    - バリデーションエラーなど
- `内容に応じてその例外を投げるレイヤーは異なる`ことに注意
- それぞれのレイヤーの責務に応じたバリデーションを行い、異常があればそのレイヤーで定義している例外を投げる
- プレゼンテーション層が例外を投げるのは、API仕様としてリクエストパラメータの必須/任意や最大文字数などの制限を公開しており、リクエストがその条件を満たさなかった場合
    - その仕様を定義しているプレゼンテーション層でチェックし、例外を投げる（もしくは例外を使わずエラーレスポンスを返す）