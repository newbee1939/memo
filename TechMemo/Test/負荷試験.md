## 負荷テストの目的

1. 各種ユースケースの応答性能を推測する
2. 高負荷時の性能改善を行う
3. 目的の性能を提供することができるハードウェアをあらかじめ選定する
4. システムがスケール性を持つことを確認する
5. システムのスケール特性（「どの部分を増強すれば性能がどれだけ上がるか」という性質）を把握する

## サービスの性質によって負荷テストのやり方は異なる

- 大きく分けて`シナリオテストが必要かどうか`によって、やり方や使用するツールが変わってくる

## 負荷テストツールの選定

- k6 はGrafana Labsが開発している負荷テストツールおよびSaaS

## 負荷テストの流れ

負荷テストのアプローチと目的。

- 性能テスト：システムが想定している負荷に対し、どの程度のスループットやレイテンシかを確認する
- 限界テスト：処理限界に近い、または超過した負荷に対し、エラーが出るかなど、挙動を確認する
- 耐久テスト：長時間負荷をかけた際の挙動を確認する

負荷テストの流れ。（シナリオがあるパターン）

1. 負荷テスト計画書の作成
2. 負荷テスト環境の構築・負荷テスト対象のスペックを最低限に変更
3. ダミーデータ作成
4. 負荷テスト環境と負荷テストツールの検証
5. 単一エンドポイントに対するテスト
6. オートスケールを有効にした場合のテスト
7. シナリオテスト
8. 耐久テスト

5から7に関しては、起動クライアント数を徐々に上げ、負荷を上げていくことでスループットが限界となる負荷を探索していくので、性能テストと限界テストを兼ねている。

## スループットとレイテンシ（応答時間）

- スループット
  - 単位時間当たりの処理能力やデータ転送量のこと
  - `１秒間に処理を行うHTTPリクエストの数`
- レイテンシ
  - 転送要求を出してから実際にデータが送られてくるまでに生じる通信の遅延時間のこと
  - `アプリケーションの処理時間によって遅延した時間`

## 負荷テストの進め方

1. スループットの限界値を見つける
2. 負荷をかけてボトルネックを探す
3. チューニングをする
4. 改善したかを確認する

## ⭐️現実のパターンを想定してテストシナリオを作る

- e.g. 
  - 一定のリクエストを送り続ける
  - リクエストのを急激にスパイクさせる

## 参考

- [1ヶ月で負荷テストの基礎から学んで実際にやってみた知見](https://engineering.dena.com/blog/2021/10/healthcare-load-testing/)
- 達人が教えるWebパフォーマンスチューニング〜ISUCONから学ぶ高速化の実践

## めも
