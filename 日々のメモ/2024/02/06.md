## ps aux

## 原因が分からないとき

- ヒントを増やすための活動
  - ログレベルを変えてみる
  - より多くの情報が出るようにする

## CodeIgniterでメンテナンスモードにする

```php
$route['(:any)'] = 'maintenance';
```

```php
<?php
require_once APPPATH . 'controllers/common.php';

class Maintenance extends CommonController
{
    /**
     * クラスオブジェクトコンストラクタ
     *
     * @param
     * @return
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * メンテナンス画面を表示する
     */
    public function index()
    {
        $this->display('maintenance/index.tpl', []);
    }

}
```

## Apacheのログ設定について

以下のように、LogLevelディレクティブで設定できる。

```conf
LogLevel debug
```

## ApacheのLocationとアクセス設定

- Locationディレクティブ
  - 指定のURLにディレクティブを適用する
- `Require all granted`
- `Require all denied`

## 隙間時間は記事を消費する

## Apacheの読み込み順序などについて

000-default.confとかはいつ読み込まれる？
ServerNameの役割は？

## Cloud RunのProbeで403が返ってきていた原因について

解消の流れを以下にメモしておく。

1. Cloud RunにProbeの設定を追加したが、403が返ってくる。エラーメッセージが無いため何も分からない
2. とりあえず材料を集めようと思い、ApacheのLogLevelの設定をdebugにしてみた
3. 以下のような詳細なログが出た
```
[Tue Feb 06 00:47:46.282452 2024] [authz_core:debug] [pid 14] mod_authz_core.c(815): [client 232.254.232.126:2877] AH01626: authorization result of Require all denied: denied
[Tue Feb 06 00:47:46.282646 2024] [authz_core:debug] [pid 14] mod_authz_core.c(815): [client 232.254.232.126:2877] AH01626: authorization result of <RequireAny>: denied
[Tue Feb 06 00:47:46.282656 2024] [authz_core:error] [pid 14] [client 232.254.232.126:2877] AH01630: client denied by server configuration: /var/www/html/probe
```
4. 以下のように考察できる
    - 最初にmainのhoge.confが呼ばれるが、ServerNameが一致しないためにその設定が適用されない
    - 000-default.confにリクエストが流れて、`Access Denied`
5. 上記の考察を確かめるために、000-default.confの`Access Denied`の部分をコメントアウトしてみた。すると403から404に変わった
6. 間違いなく、000-default.confにリクエストが流れてそう。hoge.confのDocumentRootである`/var/www/hoge/public/probe`ではなく、000-default.confの`/var/www/html/probe`にリクエストが来ていることからも想定できる
7. あとは、Cloud RunのprobeにServerNameと合致するhost名でリクエストを送信すればいい。結論、以下のように設定すればいける

```yml
startupProbe:
  httpGet:
    path: /probe
    port: 80
    httpHeaders:
      - name: host
        value: hoge.example.com
```

### 学び

- 材料が無い場合は、とりあえず材料を集めるためにどうすべきかを考える
    - Loglevelを変えてみるとか
- ProbeのリクエストをServerNameと合致させるためにどうすべきか？について
    - 少し考えればheaderのhostに指定すればいいと分かるはず
    - あと一歩深く考えるクセをつける..!
    - 惜しいところまでは来ている

## 良さそうなVSCode拡張

TODO: 拡張入れる

- Laravel Goto Config
    - https://marketplace.visualstudio.com/items?itemName=ctf0.laravel-goto-config
- vscode-icons
    - https://www.tairaengineer-note.com/visual-studio-code-vscode-icons-install/
- Trailing Spaces
    - https://marketplace.visualstudio.com/items?itemName=shardulm94.trailing-spaces

## KubernetesのProbeのhttpGetに設定可能な値

- host: 接続先ホスト名。デフォルトはPod IP。おそらくはこのフィールドの代わりにhttpHeaders内の"Host"を代わりに使用することになります。
- scheme: ホストへの接続で使用するスキーマ（HTTP または HTTPS）。デフォルトは HTTP。
- path: HTTPサーバーへアクセスする際のパス
- httpHeaders: リクエスト内のカスタムヘッダー。HTTPでは重複したヘッダーが許可されています。
- port: コンテナにアクセスする際のポートの名前または番号。ポート番号の場合、1から65535の範囲内である必要があります。

HTTPによるProbeの場合、kubeletは指定したパスとポートに対するHTTPリクエストを送ることでチェックを行う。
schemeフィールドにHTTPSがセットされている場合、kubeletは証明書の検証を行わずにHTTPSリクエストを送る。

参考: https://kubernetes.io/ja/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/

## Cloud Runだと、以下のようにscheme: HTTPSを指定することはできないっぽい

```yml
startupProbe:
  httpGet:
    path: /probe
    port: 80
    scheme: HTTPS
    httpHeaders:
```

以下のようなエラーになる。

```
Deployment failed
ERROR: (gcloud.run.services.replace) service.spec.template.spec.containers[0].liveness_probe.http_get.scheme: must not be set.
```

## ステータスコード400

参考: https://developer.mozilla.org/ja/docs/Web/HTTP/Status/400

HyperText Transfer Protocol (HTTP) の 400 Bad Request レスポンスステータスコードは、何らかのクライアント側のエラーであると分かったために、サーバーがそのリクエストを処理しない (できない) ことを表します (例えば、リクエストの構文が正しくない、リクエストメッセージのフレーミングが無効、リクエスト経路に偽りがあるなど)。

## 技術記事

- VSCodeへ「Hey Code!」と呼びかけ、Copilot Chatが起動する新機能。2024年1月のアップデート
    - https://www.publickey1.jp/blog/24/vscodehey_codecopilot_chat20241.html
    - VSCodeのインラインのチャット機能を有効にしたうえで、エディタ画面で「Hey Code!」と呼びかける
    - 設定「accessibility.voice.keywordActivation」を有効にし、拡張機能の「VS Code Speech」と「GitHub Copilot Chat」を導入することで利用可能になります
- 街中でApple Vision Proを使用するひと足先に行ってしまったユーザーの目撃例が続々報告される
    - https://gigazine.net/news/20240204-apple-vision-pro-use-case/
    - 2024年2月2日にアメリカで発売されたApple初の空間コンピューター「Apple Vision Pro」を着用したまま街中をかっぽする一歩未来を進むユーザーの目撃例が複数報告されています
- 牛尾剛氏が語る『世界一流エンジニアの思考法』への道──英語力や技術力を覆す、三流ならではの戦略とは？
    - https://codezine.jp/article/detail/18946

